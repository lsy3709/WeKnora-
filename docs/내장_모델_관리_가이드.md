# 내장 모델 관리 가이드

## 개요

내장 모델(Built-in Models)은 시스템 수준의 모델 설정으로, 모든 테넌트에게 노출되지만 민감한 정보는 숨겨지며 수정이나 삭제가 불가능합니다. 내장 모델은 보통 시스템 기본 모델 설정을 제공하여 모든 테넌트가 동일한 모델 서비스를 사용할 수 있도록 보장하는 데 사용됩니다.

## 내장 모델 특성

- **모든 테넌트 가시성**: 내장 모델은 모든 테넌트에게 보여지며 별도의 설정이 필요 없습니다.
- **보안 보호**: 내장 모델의 민감 정보(API Key, Base URL)는 숨겨지며 상세 내용을 확인할 수 없습니다.
- **읽기 전용**: 내장 모델은 편집하거나 삭제할 수 없으며, 기본 모델로 설정만 가능합니다.
- **통합 관리**: 시스템 관리자가 통합 유지보수하여 설정의 일관성과 보안을 보장합니다.

## 내장 모델 추가 방법

내장 모델은 데이터베이스에 직접 삽입해야 합니다. 다음은 내장 모델을 추가하는 단계입니다:

### 1. 모델 데이터 준비

먼저 내장 모델로 설정할 모델의 구성 정보를 준비합니다:
- 모델 이름 (name)
- 모델 유형 (type): `KnowledgeQA`, `Embedding`, `Rerank`, 또는 `VLLM`
- 모델 소스 (source): `local` 또는 `remote`
- 모델 파라미터 (parameters): base_url, api_key, provider 등 포함
- 테넌트 ID (tenant_id): 충돌 방지를 위해 10000보다 작은 ID 사용 권장

**지원되는 서비스 제공자 (provider)**: `generic`(사용자 정의), `openai`, `aliyun`, `zhipu`, `volcengine`, `hunyuan`, `deepseek`, `minimax`, `mimo`, `siliconflow`, `jina`, `openrouter`, `gemini`, `modelscope`, `moonshot`, `qianfan`, `qiniu`, `longcat`, `gpustack`

### 2. SQL 삽입 문 실행

다음 SQL 문을 사용하여 내장 모델을 삽입합니다:

```sql
-- 예시: LLM 내장 모델 삽입
INSERT INTO models (
    id,
    tenant_id,
    name,
    type,
    source,
    description,
    parameters,
    is_default,
    status,
    is_builtin
) VALUES (
    'builtin-llm-001',                    -- 고유 ID, builtin- 접두사 권장
    10000,                                -- 테넌트 ID
    'GPT-4',                              -- 모델 이름
    'KnowledgeQA',                        -- 모델 유형
    'remote',                             -- 모델 소스
    '내장 LLM 모델',                       -- 설명
    '{"base_url": "https://api.openai.com/v1", "api_key": "sk-xxx", "provider": "openai"}'::jsonb,  -- 파라미터 (JSON 형식)
    false,                                -- 기본값 여부
    'active',                             -- 상태
    true                                  -- 내장 모델로 표시
) ON CONFLICT (id) DO NOTHING;

-- 예시: Embedding 내장 모델 삽입
INSERT INTO models (
    id,
    tenant_id,
    name,
    type,
    source,
    description,
    parameters,
    is_default,
    status,
    is_builtin
) VALUES (
    'builtin-embedding-001',
    10000,
    'text-embedding-ada-002',
    'Embedding',
    'remote',
    '내장 Embedding 모델',
    '{"base_url": "https://api.openai.com/v1", "api_key": "sk-xxx", "provider": "openai", "embedding_parameters": {"dimension": 1536, "truncate_prompt_tokens": 0}}'::jsonb,
    false,
    'active',
    true
) ON CONFLICT (id) DO NOTHING;
```

## 주의 사항

1. **보안**: 내장 모델을 추가할 때 입력하는 `api_key`와 `base_url`은 데이터베이스에 일반 텍스트로 저장되지만, 프론트엔드 API 호출 시에는 시스템에서 마스킹 처리하여 안전하게 보호합니다.
2. **테넌트 격리**: 내장 모델은 모든 테넌트가 공유하지만, 테넌트가 직접 추가한 모델은 해당 테넌트만 볼 수 있습니다.
3. **ID 관리**: `builtin-` 접두사를 사용하여 내장 모델임을 명확히 구분하고 ID 중복을 피하십시오.
